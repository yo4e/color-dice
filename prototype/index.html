<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Theme Rand</title>
<style>
  :root{
    --bg:#0b0b0f; --surface:#141421; --text:#f4f4f6; --muted:#b8b8c2;
    --primary:#7c5cff; --accent:#3df2c7; --ring:rgba(125,92,255,.35);
  }
  body{margin:0;font-family:ui-sans-serif,system-ui; background:var(--bg); color:var(--text);}
  .wrap{max-width:980px;margin:0 auto;padding:24px;}
  .row{display:grid;grid-template-columns:1fr;gap:16px;}
  .card{background:var(--surface);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;}
  .btn{cursor:pointer;border:0;border-radius:12px;padding:10px 12px;background:var(--primary);color:white;}
  .btn:focus{outline:4px solid var(--ring);}
  .swatches{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
  .sw{border-radius:14px;min-height:64px;padding:10px;border:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;gap:4px;}
  .sw code{font-size:12px;opacity:.9}
  .preview a{color:var(--accent);text-decoration:none}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px;color:var(--muted)}
  textarea{width:100%;min-height:130px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.2);color:var(--text);padding:10px;font-family:ui-monospace,Menlo,monospace;}
  @media (min-width:760px){ .row{grid-template-columns:1.2fr .8fr;} .swatches{grid-template-columns:repeat(2,1fr);} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <button class="btn" id="gen">Generate (Space)</button>
      <button class="btn" id="copy" style="background:var(--accent);color:#06110e">Copy CSS vars</button>
      <span class="pill" id="seed"></span>
    </div>
  </div>

  <div class="row" style="margin-top:16px">
    <div class="card preview">
      <h2 style="margin:0 0 8px">Preview</h2>
      <p style="margin:0 0 10px;color:var(--muted)">背景 / 文字 / ボタン / リンクが最低限見えるテーマだけ出す。</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin:12px 0">
        <button class="btn">Primary</button>
        <button class="btn" style="background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.14)">Ghost</button>
        <a href="#">Link / Accent</a>
      </div>
      <div class="swatches" id="swatches"></div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px">CSS</h2>
      <textarea id="out" spellcheck="false"></textarea>
      <p style="margin:10px 0 0;color:var(--muted);font-size:12px">Tips: Spaceで次、気に入ったら保存用にコピペ。</p>
    </div>
  </div>
</div>

<script>
  // --- utils ---
  const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
  const hslToRgb=(h,s,l)=>{
    s/=100; l/=100;
    const k=n=> (n + h/30)%12;
    const a=s*Math.min(l,1-l);
    const f=n=> l - a*Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n), 1)));
    return [f(0),f(8),f(4)].map(v=>Math.round(v*255));
  };
  const rgbToHex=(r,g,b)=>'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
  const relLum=(r,g,b)=>{
    const srgb=[r,g,b].map(v=>{
      v/=255; return v<=0.03928 ? v/12.92 : Math.pow((v+0.055)/1.055,2.4);
    });
    return 0.2126*srgb[0]+0.7152*srgb[1]+0.0722*srgb[2];
  };
  const contrast=(hex1,hex2)=>{
    const p=h=>[1,3,5].map(i=>parseInt(h.slice(i,i+2),16));
    const [r1,g1,b1]=p(hex1), [r2,g2,b2]=p(hex2);
    const L1=relLum(r1,g1,b1), L2=relLum(r2,g2,b2);
    const hi=Math.max(L1,L2), lo=Math.min(L1,L2);
    return (hi+0.05)/(lo+0.05);
  };

  // seeded rng (mulberry32)
  const mulberry32 = a => () => {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };

  function genTheme(seed){
    const rand = mulberry32(seed);
    const hue = Math.floor(rand()*360);
    const modeDark = rand() < 0.85; // ほぼダーク
    // base lightness
    let bgL = modeDark ? (6 + rand()*6) : (92 + rand()*5);
    let bgS = 10 + rand()*10;
    let bg = rgbToHex(...hslToRgb(hue, bgS, bgL));

    // surface slightly lighter/darker
    let surfL = modeDark ? (bgL + 6 + rand()*8) : (bgL - 6 - rand()*8);
    let surface = rgbToHex(...hslToRgb(hue, bgS+8, clamp(surfL, 0, 100)));

    // text: ensure contrast >= 7 ideally
    let text = modeDark ? '#f4f4f6' : '#0b0b0f';
    if(contrast(bg, text) < 7){
      text = modeDark ? '#ffffff' : '#000000';
    }
    let muted = modeDark ? '#b8b8c2' : '#2d2d35';

    // primary: neon-ish but controlled
    const pHue = (hue + (rand()<0.5 ? 30 : 330) + Math.floor(rand()*20)) % 360;
    const primary = rgbToHex(...hslToRgb(pHue, 75 + rand()*15, modeDark ? 60 + rand()*8 : 45 + rand()*8));

    // accent: complementary-ish
    const aHue = (hue + 180 + Math.floor(rand()*30 - 15) + 360) % 360;
    const accent = rgbToHex(...hslToRgb(aHue, 75 + rand()*15, modeDark ? 55 + rand()*10 : 45 + rand()*10));

    // If buttons unreadable, adjust
    let btnText = '#ffffff';
    if(contrast(primary, btnText) < 4.5) btnText = '#0b0b0f';

    return {bg, surface, text, muted, primary, accent, ring:`rgba(125,92,255,.35)`, btnText, seed};
  }

  function apply(t){
    const r=document.documentElement.style;
    r.setProperty('--bg', t.bg);
    r.setProperty('--surface', t.surface);
    r.setProperty('--text', t.text);
    r.setProperty('--muted', t.muted);
    r.setProperty('--primary', t.primary);
    r.setProperty('--accent', t.accent);
    r.setProperty('--ring', `rgba( ${parseInt(t.primary.slice(1,3),16)}, ${parseInt(t.primary.slice(3,5),16)}, ${parseInt(t.primary.slice(5,7),16)}, .35 )`);

    document.getElementById('seed').textContent = `seed: ${t.seed}`;
    const css =
`:root{
  --bg: ${t.bg};
  --surface: ${t.surface};
  --text: ${t.text};
  --muted: ${t.muted};
  --primary: ${t.primary};
  --accent: ${t.accent};
}`;
    document.getElementById('out').value = css;

    const sw = [
      ['bg', t.bg], ['surface', t.surface], ['text', t.text],
      ['muted', t.muted], ['primary', t.primary], ['accent', t.accent],
    ];
    const box = document.getElementById('swatches');
    box.innerHTML = sw.map(([name,val])=>`
      <div class="sw" style="background:${val};color:${contrast(val,'#ffffff')>=4.5?'#fff':'#000'}">
        <div style="font-weight:700">${name}</div>
        <code>${val}</code>
      </div>`).join('');
  }

  let seed = (Date.now() >>> 0);
  function next(){
    seed = (seed + 0x9E3779B9) >>> 0;
    apply(genTheme(seed));
  }

  document.getElementById('gen').onclick = next;
  document.getElementById('copy').onclick = async ()=>{
    try{
      await navigator.clipboard.writeText(document.getElementById('out').value);
      document.getElementById('copy').textContent = 'Copied!';
      setTimeout(()=>document.getElementById('copy').textContent='Copy CSS vars', 900);
    }catch(e){
      alert('コピーできなかった（権限/HTTPSを確認）');
    }
  };
  window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); next(); }});

  next();
</script>
</body>
</html>
